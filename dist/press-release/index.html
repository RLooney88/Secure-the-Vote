<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Press Releases & News - Secure the Vote MD</title>
    <meta name="description" content="Latest press releases and news from Secure the Vote Maryland - Election Integrity Updates">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Questrial&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --maroon: #9B1E37;
            --gold: #F6BF58;
            --white: #ffffff;
            --gray-light: #f5f5f5;
            --gray-medium: #666;
            --gray-dark: #333;
            --font-primary: 'Poppins', sans-serif;
            --font-secondary: 'Questrial', sans-serif;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-secondary);
            line-height: 1.6;
            color: var(--gray-dark);
            background: var(--white);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header Spacer */
        .header-spacer {
            height: 140px;
        }
        
        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, var(--maroon) 0%, #6d1527 100%);
            color: var(--white);
            padding: 60px 0;
            text-align: center;
        }
        
        .hero h1 {
            font-family: var(--font-primary);
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        .hero p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        /* Blog Grid */
        .blog-section {
            padding: 60px 0;
        }
        
        .blog-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 1024px) {
            .blog-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .blog-grid {
                grid-template-columns: 1fr;
            }
            .hero h1 {
                font-size: 2rem;
            }
        }
        
        /* Blog Card */
        .blog-card {
            background: var(--white);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .blog-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }
        
        .blog-card-image {
            width: 100%;
            height: 220px;
            background: var(--gray-light);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .blog-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .blog-card-image.placeholder {
            background: linear-gradient(135deg, var(--maroon) 0%, var(--gold) 100%);
            color: var(--white);
            font-size: 3rem;
            font-weight: 700;
        }
        
        .blog-card-content {
            padding: 25px;
        }
        
        .blog-card-meta {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            font-size: 0.85rem;
            color: var(--gray-medium);
        }
        
        .blog-card-category {
            background: var(--gold);
            color: var(--white);
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: 500;
        }
        
        .blog-card h2 {
            font-family: var(--font-primary);
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 12px;
            line-height: 1.3;
            color: var(--gray-dark);
        }
        
        .blog-card-excerpt {
            font-size: 0.95rem;
            color: var(--gray-medium);
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .blog-card-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--maroon);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            transition: color 0.3s ease;
        }
        
        .blog-card-link:hover {
            color: var(--gold);
        }
        
        .blog-card-link::after {
            content: 'â†’';
            transition: transform 0.3s ease;
        }
        
        .blog-card-link:hover::after {
            transform: translateX(4px);
        }
        
        /* Loading & Empty States */
        .loading, .empty-state {
            text-align: center;
            padding: 60px 20px;
        }
        
        .loading {
            font-size: 1.2rem;
            color: var(--gray-medium);
        }
        
        .spinner {
            border: 4px solid var(--gray-light);
            border-top: 4px solid var(--maroon);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .empty-state h2 {
            font-family: var(--font-primary);
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: var(--gray-dark);
        }
        
        /* Show More Button */
        .show-more-container {
            text-align: center;
            padding: 20px 0 40px;
        }
        
        .show-more-btn {
            background: var(--maroon);
            color: var(--white);
            border: none;
            padding: 15px 40px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease;
            font-family: var(--font-primary);
        }
        
        .show-more-btn:hover {
            background: #7a1828;
            transform: translateY(-2px);
        }
        
        .show-more-btn:disabled {
            background: var(--gray-light);
            color: var(--gray-medium);
            cursor: not-allowed;
            transform: none;
        }
        
        .hidden {
            display: none;
        }
    </style>
    
    <!-- Template Loading (Header/Footer) -->
    <div id="template-loading" style="position:fixed;top:0;left:0;right:0;bottom:0;background:#fff;display:flex;align-items:center;justify-content:center;z-index:9999;">
        <div style="text-align:center;">
            <div class="spinner"></div>
            <p style="color:#666;font-family:sans-serif;">Loading...</p>
        </div>
    </div>
    <div id="site-header"></div>
</head>
<body>
    <div class="header-spacer"></div>
    
    <section class="stv-hero-banner" style="position:relative;width:100%;min-height:260px;background:url('/images/political-leaders-at-conference.jpg') center/cover no-repeat fixed;display:flex;align-items:center;justify-content:center;">
        <div style="position:absolute;top:0;left:0;right:0;bottom:0;background:radial-gradient(at top left, #000000CC 0%, #9B1E37 85%);opacity:0.6;"></div>
        <div style="position:relative;z-index:2;text-align:center;padding:60px 20px;">
            <h1 style="font-family:'Questrial',sans-serif;font-size:60px;color:#fff;font-weight:400;margin:0 0 10px;">Press Releases & News</h1>
            <div style="width:80px;height:5px;background:#fff;margin:0 auto 15px;"></div>
            <p style="color:rgba(255,255,255,0.9);font-size:1.1rem;">Latest updates on Maryland election integrity and security</p>
        </div>
    </section>
    
    <section class="blog-section">
        <div class="container">
            <div id="blog-grid" class="blog-grid"></div>
            <div id="loading" class="loading hidden">
                <div class="spinner"></div>
                <p>Loading posts...</p>
            </div>
            <div id="empty-state" class="empty-state hidden">
                <h2>No Posts Found</h2>
                <p>Check back soon for updates!</p>
            </div>
            <div id="show-more-container" class="show-more-container hidden">
                <button id="show-more-btn" class="show-more-btn">Show More</button>
            </div>
        </div>
    </section>
    
    <div id="site-footer"></div>
    
    <script>
        const API_URL = '/api/posts/list';
        const POSTS_PER_PAGE = 9;
        
        let currentOffset = 0;
        let totalPosts = 0;
        let isLoading = false;
        
        const blogGrid = document.getElementById('blog-grid');
        const loadingEl = document.getElementById('loading');
        const emptyState = document.getElementById('empty-state');
        const showMoreContainer = document.getElementById('show-more-container');
        const showMoreBtn = document.getElementById('show-more-btn');
        
        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
        }
        
        // Generate post URL from published_at and slug
        function generatePostUrl(publishedAt, slug) {
            const date = new Date(publishedAt);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `/${year}/${month}/${day}/${slug}/`;
        }
        
        // Truncate excerpt
        function truncateExcerpt(text, maxLength = 150) {
            if (!text) return '';
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength).trim() + '...';
        }
        
        // Create blog card HTML
        function createBlogCard(post) {
            const postUrl = generatePostUrl(post.published_at, post.slug);
            const excerpt = truncateExcerpt(post.excerpt);
            const category = post.category || 'News';
            const date = formatDate(post.published_at);
            
            const imageHtml = post.featured_image
                ? `<img src="${post.featured_image}" alt="${post.title}" loading="lazy">`
                : `<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg, #9B1E37 0%, #F6BF58 100%);color:#fff;font-size:3rem;font-weight:700;">STV</div>`;
            
            return `
                <article class="blog-card">
                    <a href="${postUrl}" class="blog-card-image">
                        ${imageHtml}
                    </a>
                    <div class="blog-card-content">
                        <div class="blog-card-meta">
                            <span class="blog-card-category">${category}</span>
                            <span class="blog-card-date">${date}</span>
                        </div>
                        <h2>
                            <a href="${postUrl}" style="color: inherit; text-decoration: none;">
                                ${post.title}
                            </a>
                        </h2>
                        <p class="blog-card-excerpt">${excerpt}</p>
                        <a href="${postUrl}" class="blog-card-link">Read More</a>
                    </div>
                </article>
            `;
        }
        
        // Load posts
        async function loadPosts(append = false) {
            if (isLoading) return;
            
            isLoading = true;
            loadingEl.classList.remove('hidden');
            showMoreBtn.disabled = true;
            
            try {
                const response = await fetch(`${API_URL}?limit=${POSTS_PER_PAGE}&offset=${currentOffset}`);
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Failed to load posts');
                }
                
                totalPosts = data.total;
                
                if (data.posts.length === 0 && currentOffset === 0) {
                    emptyState.classList.remove('hidden');
                    showMoreContainer.classList.add('hidden');
                } else {
                    emptyState.classList.add('hidden');
                    
                    const cardsHtml = data.posts.map(createBlogCard).join('');
                    
                    if (append) {
                        blogGrid.insertAdjacentHTML('beforeend', cardsHtml);
                    } else {
                        blogGrid.innerHTML = cardsHtml;
                    }
                    
                    currentOffset += data.posts.length;
                    
                    // Show/hide "Show More" button
                    if (currentOffset < totalPosts) {
                        showMoreContainer.classList.remove('hidden');
                        showMoreBtn.disabled = false;
                    } else {
                        showMoreContainer.classList.add('hidden');
                    }
                }
            } catch (error) {
                console.error('Error loading posts:', error);
                if (currentOffset === 0) {
                    blogGrid.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                            <p style="color: var(--gray-medium);">Error loading posts. Please try again later.</p>
                        </div>
                    `;
                }
            } finally {
                isLoading = false;
                loadingEl.classList.add('hidden');
            }
        }
        
        // Show More button click handler
        showMoreBtn.addEventListener('click', () => {
            loadPosts(true);
        });
        
        // Initial load
        loadPosts();
    </script>

    <script>
// Use Shadow DOM to isolate templates from Elementor CSS
async function loadTemplate(hostId, htmlUrl, cssUrl, jsUrl) {
  const host = document.getElementById(hostId);
  const shadow = host.attachShadow({ mode: 'open' });
  
  const [htmlRes, cssRes] = await Promise.all([
    fetch(htmlUrl).then(r => r.text()),
    fetch(cssUrl).then(r => r.text())
  ]);
  
  shadow.innerHTML = '<style>' + cssRes + '</style>' + htmlRes;
  
  if (jsUrl) {
    const jsRes = await fetch(jsUrl).then(r => r.text());
    const script = document.createElement('script');
    script.textContent = jsRes;
    shadow.appendChild(script);
  }
}

// Load Font Awesome inside shadow DOMs
const faLink = '<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">';

fetch('https://site-builder-ai-production.up.railway.app/sites/securethevotemd/templates')
  .then(r => r.json())
  .then(templateData => {
    const headerHtml = templateData.header;
    const footerHtml = templateData.footer;
    const css = templateData.css;
  const varFix = `<style>
    :host { display: block; width: 100%; }
    :host * { box-sizing: border-box; }
    :root, :host {
      --color-maroon: #8B1A1A;
      --color-maroon-dark: #5d1111;
      --color-red: #C41E3A;
      --color-gold: #F6BF58;
      --color-gold-dark: #d9a03f;
      --color-white: #ffffff;
      --color-black: #000000;
      --color-gray-light: #f5f5f5;
      --color-gray-medium: #666666;
      --color-gray-dark: #333333;
      --font-primary: 'Poppins', sans-serif;
      --font-secondary: 'Questrial', sans-serif;
      --nav-height: 80px;
      --top-bar-height: 40px;
      --banner-height: 48px;
    }
  </style>`;
  
  // Header shadow DOM
  const headerHost = document.getElementById('site-header');
  const headerShadow = headerHost.attachShadow({ mode: 'open' });
  headerShadow.innerHTML = faLink + varFix + '<style>' + css + '</style>' + headerHtml;
  // Hamburger menu handler
  var hbtn = headerShadow.querySelector('.hamburger-menu');
  var hnav = headerShadow.querySelector('.primary-nav');
  if (hbtn && hnav) {
    hbtn.addEventListener('click', function(e) {
      e.preventDefault();
      var open = hbtn.getAttribute('aria-expanded') === 'true';
      hbtn.setAttribute('aria-expanded', !open);
      hnav.classList.toggle('mobile-open');
      document.body.style.overflow = !open ? 'hidden' : '';
    });
    hnav.querySelectorAll('a[href]:not([href="#"])').forEach(function(a) {
      a.addEventListener('click', function() {
        hbtn.setAttribute('aria-expanded', 'false');
        hnav.classList.remove('mobile-open');
        document.body.style.overflow = '';
      });
    });
    hnav.querySelectorAll('.has-dropdown > a[href="#"]').forEach(function(a) {
      a.addEventListener('click', function(e) {
        e.preventDefault();
        var dd = this.parentElement.querySelector('.dropdown');
        if (dd) dd.style.display = dd.style.display === 'block' ? 'none' : 'block';
      });
    });
  }

  // Footer shadow DOM
  const footerHost = document.getElementById('site-footer');
  const footerShadow = footerHost.attachShadow({ mode: 'open' });
  footerShadow.innerHTML = faLink + varFix + '<style>' + css + '</style>' + footerHtml;
  
  // Scroll-up animation: IntersectionObserver watches the footer host from the main document
  // (Shadow DOM elements aren't directly observable from outside, but the host element is)
  const logoBox = footerShadow.querySelector('.footer-logo-box');
  if (logoBox) {
    const obs = new IntersectionObserver((entries) => {
      entries.forEach(e => { if (e.isIntersecting) { logoBox.classList.add('visible'); obs.unobserve(e.target); }});
    }, { root: null, threshold: 0.15 });
    // Observe the host element (visible in main DOM) as a proxy for the shadow content
    obs.observe(footerHost);
  }

  var ls = document.getElementById('template-loading'); if (ls) ls.remove();
});
</script>
</body>
</html>
