# SecureTheVote Architecture

**Last Updated:** 2026-02-13

## File Structure (Single Source of Truth)

```
Secure-the-Vote/
├── dist/                           # Static files served by Vercel
│   ├── admin/
│   │   └── index.html             # Admin dashboard (email + password login)
│   ├── css/
│   │   └── admin.css              # Admin dashboard styles
│   ├── js/
│   │   └── admin.js               # Admin dashboard JavaScript
│   └── [other static HTML pages]
│
├── api/                            # Vercel Serverless Functions
│   ├── admin/
│   │   ├── _auth.js               # JWT authentication utilities
│   │   ├── login.js               # POST /api/admin/login
│   │   ├── signatures.js          # GET /api/admin/signatures
│   │   ├── export.js              # GET /api/admin/export (CSV)
│   │   ├── list.js                # GET /api/admin/list (list all admins)
│   │   ├── create.js              # POST /api/admin/create (add new admin)
│   │   ├── delete.js              # DELETE /api/admin/delete (remove admin)
│   │   └── setup.js               # POST /api/admin/setup (initialize DB)
│   └── petition/
│       └── submit.js              # POST /api/petition/submit (public)
│
├── scripts/
│   ├── setup-admin.js             # Create initial admin account
│   └── update-password.js         # Update admin password
│
└── schema.sql                     # Database schema (Railway Postgres)
```

## Technology Stack

### Frontend
- **Admin Dashboard:** Vanilla HTML/CSS/JavaScript (no framework)
- **Static Site:** Pre-built HTML in `dist/` directory
- **Hosting:** Vercel (auto-deploy from GitHub)

### Backend
- **Database:** Railway Postgres
- **API:** Vercel Serverless Functions (Node.js)
- **Authentication:** JWT tokens (24-hour expiry)
- **Email:** SendGrid API

## Database Schema

### Tables

**admins**
- `id` (serial primary key)
- `email` (varchar, unique)
- `password_hash` (varchar, bcrypt)
- `created_at` (timestamp)

**petition_signatures**
- `id` (serial primary key)
- `petition_name` (varchar)
- `full_name` (varchar)
- `email` (varchar)
- `zip_code` (varchar)
- `created_at` (timestamp)
- `ip_address` (varchar)

## Environment Variables

**Vercel:**
- `DATABASE_URL` - Railway Postgres connection string
- `JWT_SECRET` - Secret for JWT token signing
- `SENDGRID_API_KEY` - For email notifications

**Railway:**
- `DATABASE_URL` - Auto-generated by Railway
- `SENDGRID_API_KEY` - For future backend email tasks

## Admin Dashboard Features

1. **Login** - Email + password authentication
2. **View Signatures** - Paginated table with search/filter
3. **Export Signatures** - Download as CSV
4. **Admin Management:**
   - Add new admins (auto-generate secure passwords)
   - List all admins
   - Delete admins (with self-protection)
5. **Email Notifications** - Password resets, new admin invitations

## API Endpoints

### Admin (Protected with JWT)
- `POST /api/admin/login` - Login, returns JWT token
- `GET /api/admin/signatures` - List petition signatures (paginated)
- `GET /api/admin/export` - Export signatures as CSV
- `GET /api/admin/list` - List all admin users
- `POST /api/admin/create` - Create new admin user
- `DELETE /api/admin/delete?id={id}` - Delete admin user

### Public
- `POST /api/petition/submit` - Submit petition signature

## Deployment

1. **Push to GitHub** - Commit to `main` branch
2. **Vercel Auto-Deploy** - Automatically builds and deploys
3. **Database Migrations** - Run manually via Railway dashboard or scripts

## Access URLs

- **Website:** https://secure-the-vote.vercel.app/
- **Admin Dashboard:** https://secure-the-vote.vercel.app/admin/
- **Railway Dashboard:** https://railway.app/project/60af393b-ff3c-4271-b0a6-b34af97466ed

## Credentials Storage

All credentials are encrypted and stored in:
```
~/.openclaw/workspace/secrets/roddy/
├── securethevote-database.json.enc       # Railway Postgres credentials
├── securethevote-sendgrid-api-key.json.enc  # SendGrid API key
└── securethevote-admin-password.txt       # Admin password (encrypted)
```

## No Redundant Files

This architecture document represents the ONLY file structure. There are no duplicate admin dashboards or API files.
